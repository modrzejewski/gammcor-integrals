module auto2e_KetTransform_9_8
use arithmetic
use math_constants
implicit none

integer, dimension(55, 45), parameter :: RCopyIdx_9_8 = reshape([1, 19, 36, 52, 67, &
    81, 94, 106, 117, 127, 172, 189, 205, 220, 234, 247, 259, 270, 280, 325, 341, &
    356, 370, 383, 395, 406, 416, 461, 476, 490, 503, 515, 526, 536, 581, 595, 608, &
    620, 631, 641, 686, 699, 711, 722, 732, 777, 789, 800, 810, 855, 866, 876, 921, &
    931, 976, 19, 36, 52, 67, 81, 94, 106, 117, 127, 136, 189, 205, 220, 234, 247, &
    259, 270, 280, 289, 341, 356, 370, 383, 395, 406, 416, 425, 476, 490, 503, 515, &
    526, 536, 545, 595, 608, 620, 631, 641, 650, 699, 711, 722, 732, 741, 789, 800, &
    810, 819, 866, 876, 885, 931, 940, 985, 36, 52, 67, 81, 94, 106, 117, 127, 136, &
    144, 205, 220, 234, 247, 259, 270, 280, 289, 297, 356, 370, 383, 395, 406, 416, &
    425, 433, 490, 503, 515, 526, 536, 545, 553, 608, 620, 631, 641, 650, 658, 711, &
    722, 732, 741, 749, 800, 810, 819, 827, 876, 885, 893, 940, 948, 993, 52, 67, &
    81, 94, 106, 117, 127, 136, 144, 151, 220, 234, 247, 259, 270, 280, 289, 297, &
    304, 370, 383, 395, 406, 416, 425, 433, 440, 503, 515, 526, 536, 545, 553, 560, &
    620, 631, 641, 650, 658, 665, 722, 732, 741, 749, 756, 810, 819, 827, 834, 885, &
    893, 900, 948, 955, 1000, 67, 81, 94, 106, 117, 127, 136, 144, 151, 157, 234, &
    247, 259, 270, 280, 289, 297, 304, 310, 383, 395, 406, 416, 425, 433, 440, 446, &
    515, 526, 536, 545, 553, 560, 566, 631, 641, 650, 658, 665, 671, 732, 741, 749, &
    756, 762, 819, 827, 834, 840, 893, 900, 906, 955, 961, 1006, 81, 94, 106, 117, &
    127, 136, 144, 151, 157, 162, 247, 259, 270, 280, 289, 297, 304, 310, 315, 395, &
    406, 416, 425, 433, 440, 446, 451, 526, 536, 545, 553, 560, 566, 571, 641, 650, &
    658, 665, 671, 676, 741, 749, 756, 762, 767, 827, 834, 840, 845, 900, 906, 911, &
    961, 966, 1011, 94, 106, 117, 127, 136, 144, 151, 157, 162, 166, 259, 270, 280, &
    289, 297, 304, 310, 315, 319, 406, 416, 425, 433, 440, 446, 451, 455, 536, 545, &
    553, 560, 566, 571, 575, 650, 658, 665, 671, 676, 680, 749, 756, 762, 767, 771, &
    834, 840, 845, 849, 906, 911, 915, 966, 970, 1015, 106, 117, 127, 136, 144, 151, &
    157, 162, 166, 169, 270, 280, 289, 297, 304, 310, 315, 319, 322, 416, 425, 433, &
    440, 446, 451, 455, 458, 545, 553, 560, 566, 571, 575, 578, 658, 665, 671, 676, &
    680, 683, 756, 762, 767, 771, 774, 840, 845, 849, 852, 911, 915, 918, 970, 973, &
    1018, 117, 127, 136, 144, 151, 157, 162, 166, 169, 171, 280, 289, 297, 304, 310, &
    315, 319, 322, 324, 425, 433, 440, 446, 451, 455, 458, 460, 553, 560, 566, 571, &
    575, 578, 580, 665, 671, 676, 680, 683, 685, 762, 767, 771, 774, 776, 845, 849, &
    852, 854, 915, 918, 920, 973, 975, 1020, 172, 189, 205, 220, 234, 247, 259, 270, &
    280, 289, 325, 341, 356, 370, 383, 395, 406, 416, 425, 461, 476, 490, 503, 515, &
    526, 536, 545, 581, 595, 608, 620, 631, 641, 650, 686, 699, 711, 722, 732, 741, &
    777, 789, 800, 810, 819, 855, 866, 876, 885, 921, 931, 940, 976, 985, 1021, 189, &
    205, 220, 234, 247, 259, 270, 280, 289, 297, 341, 356, 370, 383, 395, 406, 416, &
    425, 433, 476, 490, 503, 515, 526, 536, 545, 553, 595, 608, 620, 631, 641, 650, &
    658, 699, 711, 722, 732, 741, 749, 789, 800, 810, 819, 827, 866, 876, 885, 893, &
    931, 940, 948, 985, 993, 1029, 205, 220, 234, 247, 259, 270, 280, 289, 297, 304, &
    356, 370, 383, 395, 406, 416, 425, 433, 440, 490, 503, 515, 526, 536, 545, 553, &
    560, 608, 620, 631, 641, 650, 658, 665, 711, 722, 732, 741, 749, 756, 800, 810, &
    819, 827, 834, 876, 885, 893, 900, 940, 948, 955, 993, 1000, 1036, 220, 234, &
    247, 259, 270, 280, 289, 297, 304, 310, 370, 383, 395, 406, 416, 425, 433, 440, &
    446, 503, 515, 526, 536, 545, 553, 560, 566, 620, 631, 641, 650, 658, 665, 671, &
    722, 732, 741, 749, 756, 762, 810, 819, 827, 834, 840, 885, 893, 900, 906, 948, &
    955, 961, 1000, 1006, 1042, 234, 247, 259, 270, 280, 289, 297, 304, 310, 315, &
    383, 395, 406, 416, 425, 433, 440, 446, 451, 515, 526, 536, 545, 553, 560, 566, &
    571, 631, 641, 650, 658, 665, 671, 676, 732, 741, 749, 756, 762, 767, 819, 827, &
    834, 840, 845, 893, 900, 906, 911, 955, 961, 966, 1006, 1011, 1047, 247, 259, &
    270, 280, 289, 297, 304, 310, 315, 319, 395, 406, 416, 425, 433, 440, 446, 451, &
    455, 526, 536, 545, 553, 560, 566, 571, 575, 641, 650, 658, 665, 671, 676, 680, &
    741, 749, 756, 762, 767, 771, 827, 834, 840, 845, 849, 900, 906, 911, 915, 961, &
    966, 970, 1011, 1015, 1051, 259, 270, 280, 289, 297, 304, 310, 315, 319, 322, &
    406, 416, 425, 433, 440, 446, 451, 455, 458, 536, 545, 553, 560, 566, 571, 575, &
    578, 650, 658, 665, 671, 676, 680, 683, 749, 756, 762, 767, 771, 774, 834, 840, &
    845, 849, 852, 906, 911, 915, 918, 966, 970, 973, 1015, 1018, 1054, 270, 280, &
    289, 297, 304, 310, 315, 319, 322, 324, 416, 425, 433, 440, 446, 451, 455, 458, &
    460, 545, 553, 560, 566, 571, 575, 578, 580, 658, 665, 671, 676, 680, 683, 685, &
    756, 762, 767, 771, 774, 776, 840, 845, 849, 852, 854, 911, 915, 918, 920, 970, &
    973, 975, 1018, 1020, 1056, 325, 341, 356, 370, 383, 395, 406, 416, 425, 433, &
    461, 476, 490, 503, 515, 526, 536, 545, 553, 581, 595, 608, 620, 631, 641, 650, &
    658, 686, 699, 711, 722, 732, 741, 749, 777, 789, 800, 810, 819, 827, 855, 866, &
    876, 885, 893, 921, 931, 940, 948, 976, 985, 993, 1021, 1029, 1057, 341, 356, &
    370, 383, 395, 406, 416, 425, 433, 440, 476, 490, 503, 515, 526, 536, 545, 553, &
    560, 595, 608, 620, 631, 641, 650, 658, 665, 699, 711, 722, 732, 741, 749, 756, &
    789, 800, 810, 819, 827, 834, 866, 876, 885, 893, 900, 931, 940, 948, 955, 985, &
    993, 1000, 1029, 1036, 1064, 356, 370, 383, 395, 406, 416, 425, 433, 440, 446, &
    490, 503, 515, 526, 536, 545, 553, 560, 566, 608, 620, 631, 641, 650, 658, 665, &
    671, 711, 722, 732, 741, 749, 756, 762, 800, 810, 819, 827, 834, 840, 876, 885, &
    893, 900, 906, 940, 948, 955, 961, 993, 1000, 1006, 1036, 1042, 1070, 370, 383, &
    395, 406, 416, 425, 433, 440, 446, 451, 503, 515, 526, 536, 545, 553, 560, 566, &
    571, 620, 631, 641, 650, 658, 665, 671, 676, 722, 732, 741, 749, 756, 762, 767, &
    810, 819, 827, 834, 840, 845, 885, 893, 900, 906, 911, 948, 955, 961, 966, 1000, &
    1006, 1011, 1042, 1047, 1075, 383, 395, 406, 416, 425, 433, 440, 446, 451, 455, &
    515, 526, 536, 545, 553, 560, 566, 571, 575, 631, 641, 650, 658, 665, 671, 676, &
    680, 732, 741, 749, 756, 762, 767, 771, 819, 827, 834, 840, 845, 849, 893, 900, &
    906, 911, 915, 955, 961, 966, 970, 1006, 1011, 1015, 1047, 1051, 1079, 395, 406, &
    416, 425, 433, 440, 446, 451, 455, 458, 526, 536, 545, 553, 560, 566, 571, 575, &
    578, 641, 650, 658, 665, 671, 676, 680, 683, 741, 749, 756, 762, 767, 771, 774, &
    827, 834, 840, 845, 849, 852, 900, 906, 911, 915, 918, 961, 966, 970, 973, 1011, &
    1015, 1018, 1051, 1054, 1082, 406, 416, 425, 433, 440, 446, 451, 455, 458, 460, &
    536, 545, 553, 560, 566, 571, 575, 578, 580, 650, 658, 665, 671, 676, 680, 683, &
    685, 749, 756, 762, 767, 771, 774, 776, 834, 840, 845, 849, 852, 854, 906, 911, &
    915, 918, 920, 966, 970, 973, 975, 1015, 1018, 1020, 1054, 1056, 1084, 461, 476, &
    490, 503, 515, 526, 536, 545, 553, 560, 581, 595, 608, 620, 631, 641, 650, 658, &
    665, 686, 699, 711, 722, 732, 741, 749, 756, 777, 789, 800, 810, 819, 827, 834, &
    855, 866, 876, 885, 893, 900, 921, 931, 940, 948, 955, 976, 985, 993, 1000, 1021, &
    1029, 1036, 1057, 1064, 1085, 476, 490, 503, 515, 526, 536, 545, 553, 560, 566, &
    595, 608, 620, 631, 641, 650, 658, 665, 671, 699, 711, 722, 732, 741, 749, 756, &
    762, 789, 800, 810, 819, 827, 834, 840, 866, 876, 885, 893, 900, 906, 931, 940, &
    948, 955, 961, 985, 993, 1000, 1006, 1029, 1036, 1042, 1064, 1070, 1091, 490, &
    503, 515, 526, 536, 545, 553, 560, 566, 571, 608, 620, 631, 641, 650, 658, 665, &
    671, 676, 711, 722, 732, 741, 749, 756, 762, 767, 800, 810, 819, 827, 834, 840, &
    845, 876, 885, 893, 900, 906, 911, 940, 948, 955, 961, 966, 993, 1000, 1006, &
    1011, 1036, 1042, 1047, 1070, 1075, 1096, 503, 515, 526, 536, 545, 553, 560, &
    566, 571, 575, 620, 631, 641, 650, 658, 665, 671, 676, 680, 722, 732, 741, 749, &
    756, 762, 767, 771, 810, 819, 827, 834, 840, 845, 849, 885, 893, 900, 906, 911, &
    915, 948, 955, 961, 966, 970, 1000, 1006, 1011, 1015, 1042, 1047, 1051, 1075, &
    1079, 1100, 515, 526, 536, 545, 553, 560, 566, 571, 575, 578, 631, 641, 650, &
    658, 665, 671, 676, 680, 683, 732, 741, 749, 756, 762, 767, 771, 774, 819, 827, &
    834, 840, 845, 849, 852, 893, 900, 906, 911, 915, 918, 955, 961, 966, 970, 973, &
    1006, 1011, 1015, 1018, 1047, 1051, 1054, 1079, 1082, 1103, 526, 536, 545, 553, &
    560, 566, 571, 575, 578, 580, 641, 650, 658, 665, 671, 676, 680, 683, 685, 741, &
    749, 756, 762, 767, 771, 774, 776, 827, 834, 840, 845, 849, 852, 854, 900, 906, &
    911, 915, 918, 920, 961, 966, 970, 973, 975, 1011, 1015, 1018, 1020, 1051, 1054, &
    1056, 1082, 1084, 1105, 581, 595, 608, 620, 631, 641, 650, 658, 665, 671, 686, &
    699, 711, 722, 732, 741, 749, 756, 762, 777, 789, 800, 810, 819, 827, 834, 840, &
    855, 866, 876, 885, 893, 900, 906, 921, 931, 940, 948, 955, 961, 976, 985, 993, &
    1000, 1006, 1021, 1029, 1036, 1042, 1057, 1064, 1070, 1085, 1091, 1106, 595, &
    608, 620, 631, 641, 650, 658, 665, 671, 676, 699, 711, 722, 732, 741, 749, 756, &
    762, 767, 789, 800, 810, 819, 827, 834, 840, 845, 866, 876, 885, 893, 900, 906, &
    911, 931, 940, 948, 955, 961, 966, 985, 993, 1000, 1006, 1011, 1029, 1036, 1042, &
    1047, 1064, 1070, 1075, 1091, 1096, 1111, 608, 620, 631, 641, 650, 658, 665, &
    671, 676, 680, 711, 722, 732, 741, 749, 756, 762, 767, 771, 800, 810, 819, 827, &
    834, 840, 845, 849, 876, 885, 893, 900, 906, 911, 915, 940, 948, 955, 961, 966, &
    970, 993, 1000, 1006, 1011, 1015, 1036, 1042, 1047, 1051, 1070, 1075, 1079, 1096, &
    1100, 1115, 620, 631, 641, 650, 658, 665, 671, 676, 680, 683, 722, 732, 741, &
    749, 756, 762, 767, 771, 774, 810, 819, 827, 834, 840, 845, 849, 852, 885, 893, &
    900, 906, 911, 915, 918, 948, 955, 961, 966, 970, 973, 1000, 1006, 1011, 1015, &
    1018, 1042, 1047, 1051, 1054, 1075, 1079, 1082, 1100, 1103, 1118, 631, 641, 650, &
    658, 665, 671, 676, 680, 683, 685, 732, 741, 749, 756, 762, 767, 771, 774, 776, &
    819, 827, 834, 840, 845, 849, 852, 854, 893, 900, 906, 911, 915, 918, 920, 955, &
    961, 966, 970, 973, 975, 1006, 1011, 1015, 1018, 1020, 1047, 1051, 1054, 1056, &
    1079, 1082, 1084, 1103, 1105, 1120, 686, 699, 711, 722, 732, 741, 749, 756, 762, &
    767, 777, 789, 800, 810, 819, 827, 834, 840, 845, 855, 866, 876, 885, 893, 900, &
    906, 911, 921, 931, 940, 948, 955, 961, 966, 976, 985, 993, 1000, 1006, 1011, &
    1021, 1029, 1036, 1042, 1047, 1057, 1064, 1070, 1075, 1085, 1091, 1096, 1106, &
    1111, 1121, 699, 711, 722, 732, 741, 749, 756, 762, 767, 771, 789, 800, 810, &
    819, 827, 834, 840, 845, 849, 866, 876, 885, 893, 900, 906, 911, 915, 931, 940, &
    948, 955, 961, 966, 970, 985, 993, 1000, 1006, 1011, 1015, 1029, 1036, 1042, &
    1047, 1051, 1064, 1070, 1075, 1079, 1091, 1096, 1100, 1111, 1115, 1125, 711, &
    722, 732, 741, 749, 756, 762, 767, 771, 774, 800, 810, 819, 827, 834, 840, 845, &
    849, 852, 876, 885, 893, 900, 906, 911, 915, 918, 940, 948, 955, 961, 966, 970, &
    973, 993, 1000, 1006, 1011, 1015, 1018, 1036, 1042, 1047, 1051, 1054, 1070, 1075, &
    1079, 1082, 1096, 1100, 1103, 1115, 1118, 1128, 722, 732, 741, 749, 756, 762, &
    767, 771, 774, 776, 810, 819, 827, 834, 840, 845, 849, 852, 854, 885, 893, 900, &
    906, 911, 915, 918, 920, 948, 955, 961, 966, 970, 973, 975, 1000, 1006, 1011, &
    1015, 1018, 1020, 1042, 1047, 1051, 1054, 1056, 1075, 1079, 1082, 1084, 1100, &
    1103, 1105, 1118, 1120, 1130, 777, 789, 800, 810, 819, 827, 834, 840, 845, 849, &
    855, 866, 876, 885, 893, 900, 906, 911, 915, 921, 931, 940, 948, 955, 961, 966, &
    970, 976, 985, 993, 1000, 1006, 1011, 1015, 1021, 1029, 1036, 1042, 1047, 1051, &
    1057, 1064, 1070, 1075, 1079, 1085, 1091, 1096, 1100, 1106, 1111, 1115, 1121, &
    1125, 1131, 789, 800, 810, 819, 827, 834, 840, 845, 849, 852, 866, 876, 885, &
    893, 900, 906, 911, 915, 918, 931, 940, 948, 955, 961, 966, 970, 973, 985, 993, &
    1000, 1006, 1011, 1015, 1018, 1029, 1036, 1042, 1047, 1051, 1054, 1064, 1070, &
    1075, 1079, 1082, 1091, 1096, 1100, 1103, 1111, 1115, 1118, 1125, 1128, 1134, &
    800, 810, 819, 827, 834, 840, 845, 849, 852, 854, 876, 885, 893, 900, 906, 911, &
    915, 918, 920, 940, 948, 955, 961, 966, 970, 973, 975, 993, 1000, 1006, 1011, &
    1015, 1018, 1020, 1036, 1042, 1047, 1051, 1054, 1056, 1070, 1075, 1079, 1082, &
    1084, 1096, 1100, 1103, 1105, 1115, 1118, 1120, 1128, 1130, 1136, 855, 866, 876, &
    885, 893, 900, 906, 911, 915, 918, 921, 931, 940, 948, 955, 961, 966, 970, 973, &
    976, 985, 993, 1000, 1006, 1011, 1015, 1018, 1021, 1029, 1036, 1042, 1047, 1051, &
    1054, 1057, 1064, 1070, 1075, 1079, 1082, 1085, 1091, 1096, 1100, 1103, 1106, &
    1111, 1115, 1118, 1121, 1125, 1128, 1131, 1134, 1137, 866, 876, 885, 893, 900, &
    906, 911, 915, 918, 920, 931, 940, 948, 955, 961, 966, 970, 973, 975, 985, 993, &
    1000, 1006, 1011, 1015, 1018, 1020, 1029, 1036, 1042, 1047, 1051, 1054, 1056, &
    1064, 1070, 1075, 1079, 1082, 1084, 1091, 1096, 1100, 1103, 1105, 1111, 1115, &
    1118, 1120, 1125, 1128, 1130, 1134, 1136, 1139, 921, 931, 940, 948, 955, 961, &
    966, 970, 973, 975, 976, 985, 993, 1000, 1006, 1011, 1015, 1018, 1020, 1021, &
    1029, 1036, 1042, 1047, 1051, 1054, 1056, 1057, 1064, 1070, 1075, 1079, 1082, &
    1084, 1085, 1091, 1096, 1100, 1103, 1105, 1106, 1111, 1115, 1118, 1120, 1121, &
    1125, 1128, 1130, 1131, 1134, 1136, 1137, 1139, 1140], [55, 45])

contains

subroutine auto2e_RCopy_9_8(T, R, idx)
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: R
integer, dimension(:), intent(in) :: idx
T(1:10) = R(idx(1):idx(1)+9)
T(11:19) = R(idx(2):idx(2)+8)
T(20:27) = R(idx(3):idx(3)+7)
T(28:34) = R(idx(4):idx(4)+6)
T(35:40) = R(idx(5):idx(5)+5)
T(41:45) = R(idx(6):idx(6)+4)
T(46:49) = R(idx(7):idx(7)+3)
T(50:52) = R(idx(8):idx(8)+2)
T(53:54) = R(idx(9):idx(9)+1)
T(55) = R(idx(10))
T(56:64) = R(idx(11):idx(11)+8)
T(65:72) = R(idx(12):idx(12)+7)
T(73:79) = R(idx(13):idx(13)+6)
T(80:85) = R(idx(14):idx(14)+5)
T(86:90) = R(idx(15):idx(15)+4)
T(91:94) = R(idx(16):idx(16)+3)
T(95:97) = R(idx(17):idx(17)+2)
T(98:99) = R(idx(18):idx(18)+1)
T(100) = R(idx(19))
T(101:108) = R(idx(20):idx(20)+7)
T(109:115) = R(idx(21):idx(21)+6)
T(116:121) = R(idx(22):idx(22)+5)
T(122:126) = R(idx(23):idx(23)+4)
T(127:130) = R(idx(24):idx(24)+3)
T(131:133) = R(idx(25):idx(25)+2)
T(134:135) = R(idx(26):idx(26)+1)
T(136) = R(idx(27))
T(137:143) = R(idx(28):idx(28)+6)
T(144:149) = R(idx(29):idx(29)+5)
T(150:154) = R(idx(30):idx(30)+4)
T(155:158) = R(idx(31):idx(31)+3)
T(159:161) = R(idx(32):idx(32)+2)
T(162:163) = R(idx(33):idx(33)+1)
T(164) = R(idx(34))
T(165:170) = R(idx(35):idx(35)+5)
T(171:175) = R(idx(36):idx(36)+4)
T(176:179) = R(idx(37):idx(37)+3)
T(180:182) = R(idx(38):idx(38)+2)
T(183:184) = R(idx(39):idx(39)+1)
T(185) = R(idx(40))
T(186:190) = R(idx(41):idx(41)+4)
T(191:194) = R(idx(42):idx(42)+3)
T(195:197) = R(idx(43):idx(43)+2)
T(198:199) = R(idx(44):idx(44)+1)
T(200) = R(idx(45))
T(201:204) = R(idx(46):idx(46)+3)
T(205:207) = R(idx(47):idx(47)+2)
T(208:209) = R(idx(48):idx(48)+1)
T(210) = R(idx(49))
T(211:213) = R(idx(50):idx(50)+2)
T(214:215) = R(idx(51):idx(51)+1)
T(216) = R(idx(52))
T(217:218) = R(idx(53):idx(53)+1)
T(219) = R(idx(54))
T(220) = R(idx(55))
end subroutine auto2e_RCopy_9_8

subroutine auto2e_RCopy_KetTransform_9_8(S, T, Ex, Ey, Ez, R, lx, ly, lz)
!
! Transform the ket shell pair from Hermite to Cartesian Gaussian basis.
! This variant of the transformation algorithm starts by copying the Rtuv
! matrix elements into contiguous memory locations.
!
real(F64), dimension(:), intent(out) :: S
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: Ex, Ey, Ez
real(F64), dimension(:), intent(in) :: R
integer, intent(in) :: lx, ly, lz
real(F64) :: c
integer :: tau, nu, phi, i
integer :: x0, y0, z0, x, y, z
S = ZERO
x0 = ((lx + 1) * lx) / 2 + 1
y0 = ((ly + 1) * ly) / 2 + 1
z0 = ((lz + 1) * lz) / 2 + 1
do phi = 0, lz
do nu = 0, ly
do tau = 0, lx
i = ((2*8+3-phi)*phi)/2+nu+1
call auto2e_Rcopy_9_8(T, R(tau+1:), RCopyIdx_9_8(:, i))
x = x0 + tau
y = y0 + nu
z = z0 + phi
c = (-1)**modulo(tau+nu+phi, 2)*Ex(x)*Ey(y)*Ez(z)
S = S + c * T
end do
end do
end do
end subroutine auto2e_RCopy_KetTransform_9_8
end module auto2e_KetTransform_9_8