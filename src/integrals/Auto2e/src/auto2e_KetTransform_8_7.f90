module auto2e_KetTransform_8_7
use arithmetic
use math_constants
implicit none

integer, dimension(45, 36), parameter :: RCopyIdx_8_7 = reshape([1, 17, 32, 46, 59, &
    71, 82, 92, 101, 137, 152, 166, 179, 191, 202, 212, 221, 257, 271, 284, 296, &
    307, 317, 326, 362, 375, 387, 398, 408, 417, 453, 465, 476, 486, 495, 531, 542, &
    552, 561, 597, 607, 616, 652, 661, 697, 17, 32, 46, 59, 71, 82, 92, 101, 109, &
    152, 166, 179, 191, 202, 212, 221, 229, 271, 284, 296, 307, 317, 326, 334, 375, &
    387, 398, 408, 417, 425, 465, 476, 486, 495, 503, 542, 552, 561, 569, 607, 616, &
    624, 661, 669, 705, 32, 46, 59, 71, 82, 92, 101, 109, 116, 166, 179, 191, 202, &
    212, 221, 229, 236, 284, 296, 307, 317, 326, 334, 341, 387, 398, 408, 417, 425, &
    432, 476, 486, 495, 503, 510, 552, 561, 569, 576, 616, 624, 631, 669, 676, 712, &
    46, 59, 71, 82, 92, 101, 109, 116, 122, 179, 191, 202, 212, 221, 229, 236, 242, &
    296, 307, 317, 326, 334, 341, 347, 398, 408, 417, 425, 432, 438, 486, 495, 503, &
    510, 516, 561, 569, 576, 582, 624, 631, 637, 676, 682, 718, 59, 71, 82, 92, 101, &
    109, 116, 122, 127, 191, 202, 212, 221, 229, 236, 242, 247, 307, 317, 326, 334, &
    341, 347, 352, 408, 417, 425, 432, 438, 443, 495, 503, 510, 516, 521, 569, 576, &
    582, 587, 631, 637, 642, 682, 687, 723, 71, 82, 92, 101, 109, 116, 122, 127, &
    131, 202, 212, 221, 229, 236, 242, 247, 251, 317, 326, 334, 341, 347, 352, 356, &
    417, 425, 432, 438, 443, 447, 503, 510, 516, 521, 525, 576, 582, 587, 591, 637, &
    642, 646, 687, 691, 727, 82, 92, 101, 109, 116, 122, 127, 131, 134, 212, 221, &
    229, 236, 242, 247, 251, 254, 326, 334, 341, 347, 352, 356, 359, 425, 432, 438, &
    443, 447, 450, 510, 516, 521, 525, 528, 582, 587, 591, 594, 642, 646, 649, 691, &
    694, 730, 92, 101, 109, 116, 122, 127, 131, 134, 136, 221, 229, 236, 242, 247, &
    251, 254, 256, 334, 341, 347, 352, 356, 359, 361, 432, 438, 443, 447, 450, 452, &
    516, 521, 525, 528, 530, 587, 591, 594, 596, 646, 649, 651, 694, 696, 732, 137, &
    152, 166, 179, 191, 202, 212, 221, 229, 257, 271, 284, 296, 307, 317, 326, 334, &
    362, 375, 387, 398, 408, 417, 425, 453, 465, 476, 486, 495, 503, 531, 542, 552, &
    561, 569, 597, 607, 616, 624, 652, 661, 669, 697, 705, 733, 152, 166, 179, 191, &
    202, 212, 221, 229, 236, 271, 284, 296, 307, 317, 326, 334, 341, 375, 387, 398, &
    408, 417, 425, 432, 465, 476, 486, 495, 503, 510, 542, 552, 561, 569, 576, 607, &
    616, 624, 631, 661, 669, 676, 705, 712, 740, 166, 179, 191, 202, 212, 221, 229, &
    236, 242, 284, 296, 307, 317, 326, 334, 341, 347, 387, 398, 408, 417, 425, 432, &
    438, 476, 486, 495, 503, 510, 516, 552, 561, 569, 576, 582, 616, 624, 631, 637, &
    669, 676, 682, 712, 718, 746, 179, 191, 202, 212, 221, 229, 236, 242, 247, 296, &
    307, 317, 326, 334, 341, 347, 352, 398, 408, 417, 425, 432, 438, 443, 486, 495, &
    503, 510, 516, 521, 561, 569, 576, 582, 587, 624, 631, 637, 642, 676, 682, 687, &
    718, 723, 751, 191, 202, 212, 221, 229, 236, 242, 247, 251, 307, 317, 326, 334, &
    341, 347, 352, 356, 408, 417, 425, 432, 438, 443, 447, 495, 503, 510, 516, 521, &
    525, 569, 576, 582, 587, 591, 631, 637, 642, 646, 682, 687, 691, 723, 727, 755, &
    202, 212, 221, 229, 236, 242, 247, 251, 254, 317, 326, 334, 341, 347, 352, 356, &
    359, 417, 425, 432, 438, 443, 447, 450, 503, 510, 516, 521, 525, 528, 576, 582, &
    587, 591, 594, 637, 642, 646, 649, 687, 691, 694, 727, 730, 758, 212, 221, 229, &
    236, 242, 247, 251, 254, 256, 326, 334, 341, 347, 352, 356, 359, 361, 425, 432, &
    438, 443, 447, 450, 452, 510, 516, 521, 525, 528, 530, 582, 587, 591, 594, 596, &
    642, 646, 649, 651, 691, 694, 696, 730, 732, 760, 257, 271, 284, 296, 307, 317, &
    326, 334, 341, 362, 375, 387, 398, 408, 417, 425, 432, 453, 465, 476, 486, 495, &
    503, 510, 531, 542, 552, 561, 569, 576, 597, 607, 616, 624, 631, 652, 661, 669, &
    676, 697, 705, 712, 733, 740, 761, 271, 284, 296, 307, 317, 326, 334, 341, 347, &
    375, 387, 398, 408, 417, 425, 432, 438, 465, 476, 486, 495, 503, 510, 516, 542, &
    552, 561, 569, 576, 582, 607, 616, 624, 631, 637, 661, 669, 676, 682, 705, 712, &
    718, 740, 746, 767, 284, 296, 307, 317, 326, 334, 341, 347, 352, 387, 398, 408, &
    417, 425, 432, 438, 443, 476, 486, 495, 503, 510, 516, 521, 552, 561, 569, 576, &
    582, 587, 616, 624, 631, 637, 642, 669, 676, 682, 687, 712, 718, 723, 746, 751, &
    772, 296, 307, 317, 326, 334, 341, 347, 352, 356, 398, 408, 417, 425, 432, 438, &
    443, 447, 486, 495, 503, 510, 516, 521, 525, 561, 569, 576, 582, 587, 591, 624, &
    631, 637, 642, 646, 676, 682, 687, 691, 718, 723, 727, 751, 755, 776, 307, 317, &
    326, 334, 341, 347, 352, 356, 359, 408, 417, 425, 432, 438, 443, 447, 450, 495, &
    503, 510, 516, 521, 525, 528, 569, 576, 582, 587, 591, 594, 631, 637, 642, 646, &
    649, 682, 687, 691, 694, 723, 727, 730, 755, 758, 779, 317, 326, 334, 341, 347, &
    352, 356, 359, 361, 417, 425, 432, 438, 443, 447, 450, 452, 503, 510, 516, 521, &
    525, 528, 530, 576, 582, 587, 591, 594, 596, 637, 642, 646, 649, 651, 687, 691, &
    694, 696, 727, 730, 732, 758, 760, 781, 362, 375, 387, 398, 408, 417, 425, 432, &
    438, 453, 465, 476, 486, 495, 503, 510, 516, 531, 542, 552, 561, 569, 576, 582, &
    597, 607, 616, 624, 631, 637, 652, 661, 669, 676, 682, 697, 705, 712, 718, 733, &
    740, 746, 761, 767, 782, 375, 387, 398, 408, 417, 425, 432, 438, 443, 465, 476, &
    486, 495, 503, 510, 516, 521, 542, 552, 561, 569, 576, 582, 587, 607, 616, 624, &
    631, 637, 642, 661, 669, 676, 682, 687, 705, 712, 718, 723, 740, 746, 751, 767, &
    772, 787, 387, 398, 408, 417, 425, 432, 438, 443, 447, 476, 486, 495, 503, 510, &
    516, 521, 525, 552, 561, 569, 576, 582, 587, 591, 616, 624, 631, 637, 642, 646, &
    669, 676, 682, 687, 691, 712, 718, 723, 727, 746, 751, 755, 772, 776, 791, 398, &
    408, 417, 425, 432, 438, 443, 447, 450, 486, 495, 503, 510, 516, 521, 525, 528, &
    561, 569, 576, 582, 587, 591, 594, 624, 631, 637, 642, 646, 649, 676, 682, 687, &
    691, 694, 718, 723, 727, 730, 751, 755, 758, 776, 779, 794, 408, 417, 425, 432, &
    438, 443, 447, 450, 452, 495, 503, 510, 516, 521, 525, 528, 530, 569, 576, 582, &
    587, 591, 594, 596, 631, 637, 642, 646, 649, 651, 682, 687, 691, 694, 696, 723, &
    727, 730, 732, 755, 758, 760, 779, 781, 796, 453, 465, 476, 486, 495, 503, 510, &
    516, 521, 531, 542, 552, 561, 569, 576, 582, 587, 597, 607, 616, 624, 631, 637, &
    642, 652, 661, 669, 676, 682, 687, 697, 705, 712, 718, 723, 733, 740, 746, 751, &
    761, 767, 772, 782, 787, 797, 465, 476, 486, 495, 503, 510, 516, 521, 525, 542, &
    552, 561, 569, 576, 582, 587, 591, 607, 616, 624, 631, 637, 642, 646, 661, 669, &
    676, 682, 687, 691, 705, 712, 718, 723, 727, 740, 746, 751, 755, 767, 772, 776, &
    787, 791, 801, 476, 486, 495, 503, 510, 516, 521, 525, 528, 552, 561, 569, 576, &
    582, 587, 591, 594, 616, 624, 631, 637, 642, 646, 649, 669, 676, 682, 687, 691, &
    694, 712, 718, 723, 727, 730, 746, 751, 755, 758, 772, 776, 779, 791, 794, 804, &
    486, 495, 503, 510, 516, 521, 525, 528, 530, 561, 569, 576, 582, 587, 591, 594, &
    596, 624, 631, 637, 642, 646, 649, 651, 676, 682, 687, 691, 694, 696, 718, 723, &
    727, 730, 732, 751, 755, 758, 760, 776, 779, 781, 794, 796, 806, 531, 542, 552, &
    561, 569, 576, 582, 587, 591, 597, 607, 616, 624, 631, 637, 642, 646, 652, 661, &
    669, 676, 682, 687, 691, 697, 705, 712, 718, 723, 727, 733, 740, 746, 751, 755, &
    761, 767, 772, 776, 782, 787, 791, 797, 801, 807, 542, 552, 561, 569, 576, 582, &
    587, 591, 594, 607, 616, 624, 631, 637, 642, 646, 649, 661, 669, 676, 682, 687, &
    691, 694, 705, 712, 718, 723, 727, 730, 740, 746, 751, 755, 758, 767, 772, 776, &
    779, 787, 791, 794, 801, 804, 810, 552, 561, 569, 576, 582, 587, 591, 594, 596, &
    616, 624, 631, 637, 642, 646, 649, 651, 669, 676, 682, 687, 691, 694, 696, 712, &
    718, 723, 727, 730, 732, 746, 751, 755, 758, 760, 772, 776, 779, 781, 791, 794, &
    796, 804, 806, 812, 597, 607, 616, 624, 631, 637, 642, 646, 649, 652, 661, 669, &
    676, 682, 687, 691, 694, 697, 705, 712, 718, 723, 727, 730, 733, 740, 746, 751, &
    755, 758, 761, 767, 772, 776, 779, 782, 787, 791, 794, 797, 801, 804, 807, 810, &
    813, 607, 616, 624, 631, 637, 642, 646, 649, 651, 661, 669, 676, 682, 687, 691, &
    694, 696, 705, 712, 718, 723, 727, 730, 732, 740, 746, 751, 755, 758, 760, 767, &
    772, 776, 779, 781, 787, 791, 794, 796, 801, 804, 806, 810, 812, 815, 652, 661, &
    669, 676, 682, 687, 691, 694, 696, 697, 705, 712, 718, 723, 727, 730, 732, 733, &
    740, 746, 751, 755, 758, 760, 761, 767, 772, 776, 779, 781, 782, 787, 791, 794, &
    796, 797, 801, 804, 806, 807, 810, 812, 813, 815, 816], [45, 36])

contains

subroutine auto2e_RCopy_8_7(T, R, idx)
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: R
integer, dimension(:), intent(in) :: idx
T(1:9) = R(idx(1):idx(1)+8)
T(10:17) = R(idx(2):idx(2)+7)
T(18:24) = R(idx(3):idx(3)+6)
T(25:30) = R(idx(4):idx(4)+5)
T(31:35) = R(idx(5):idx(5)+4)
T(36:39) = R(idx(6):idx(6)+3)
T(40:42) = R(idx(7):idx(7)+2)
T(43:44) = R(idx(8):idx(8)+1)
T(45) = R(idx(9))
T(46:53) = R(idx(10):idx(10)+7)
T(54:60) = R(idx(11):idx(11)+6)
T(61:66) = R(idx(12):idx(12)+5)
T(67:71) = R(idx(13):idx(13)+4)
T(72:75) = R(idx(14):idx(14)+3)
T(76:78) = R(idx(15):idx(15)+2)
T(79:80) = R(idx(16):idx(16)+1)
T(81) = R(idx(17))
T(82:88) = R(idx(18):idx(18)+6)
T(89:94) = R(idx(19):idx(19)+5)
T(95:99) = R(idx(20):idx(20)+4)
T(100:103) = R(idx(21):idx(21)+3)
T(104:106) = R(idx(22):idx(22)+2)
T(107:108) = R(idx(23):idx(23)+1)
T(109) = R(idx(24))
T(110:115) = R(idx(25):idx(25)+5)
T(116:120) = R(idx(26):idx(26)+4)
T(121:124) = R(idx(27):idx(27)+3)
T(125:127) = R(idx(28):idx(28)+2)
T(128:129) = R(idx(29):idx(29)+1)
T(130) = R(idx(30))
T(131:135) = R(idx(31):idx(31)+4)
T(136:139) = R(idx(32):idx(32)+3)
T(140:142) = R(idx(33):idx(33)+2)
T(143:144) = R(idx(34):idx(34)+1)
T(145) = R(idx(35))
T(146:149) = R(idx(36):idx(36)+3)
T(150:152) = R(idx(37):idx(37)+2)
T(153:154) = R(idx(38):idx(38)+1)
T(155) = R(idx(39))
T(156:158) = R(idx(40):idx(40)+2)
T(159:160) = R(idx(41):idx(41)+1)
T(161) = R(idx(42))
T(162:163) = R(idx(43):idx(43)+1)
T(164) = R(idx(44))
T(165) = R(idx(45))
end subroutine auto2e_RCopy_8_7

subroutine auto2e_RCopy_KetTransform_8_7(S, T, Ex, Ey, Ez, R, lx, ly, lz)
!
! Transform the ket shell pair from Hermite to Cartesian Gaussian basis.
! This variant of the transformation algorithm starts by copying the Rtuv
! matrix elements into contiguous memory locations.
!
real(F64), dimension(:), intent(out) :: S
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: Ex, Ey, Ez
real(F64), dimension(:), intent(in) :: R
integer, intent(in) :: lx, ly, lz
real(F64) :: c
integer :: tau, nu, phi, i
integer :: x0, y0, z0, x, y, z
S = ZERO
x0 = ((lx + 1) * lx) / 2 + 1
y0 = ((ly + 1) * ly) / 2 + 1
z0 = ((lz + 1) * lz) / 2 + 1
do phi = 0, lz
do nu = 0, ly
do tau = 0, lx
i = ((2*7+3-phi)*phi)/2+nu+1
call auto2e_Rcopy_8_7(T, R(tau+1:), RCopyIdx_8_7(:, i))
x = x0 + tau
y = y0 + nu
z = z0 + phi
c = (-1)**modulo(tau+nu+phi, 2)*Ex(x)*Ey(y)*Ez(z)
S = S + c * T
end do
end do
end do
end subroutine auto2e_RCopy_KetTransform_8_7
end module auto2e_KetTransform_8_7