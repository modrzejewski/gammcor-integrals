module auto2e_KetTransform_9_7
use arithmetic
use math_constants
implicit none

integer, dimension(55, 36), parameter :: RCopyIdx_9_7 = reshape([1, 18, 34, 49, 63, &
    76, 88, 99, 109, 118, 154, 170, 185, 199, 212, 224, 235, 245, 254, 290, 305, &
    319, 332, 344, 355, 365, 374, 410, 424, 437, 449, 460, 470, 479, 515, 528, 540, &
    551, 561, 570, 606, 618, 629, 639, 648, 684, 695, 705, 714, 750, 760, 769, 805, &
    814, 850, 18, 34, 49, 63, 76, 88, 99, 109, 118, 126, 170, 185, 199, 212, 224, &
    235, 245, 254, 262, 305, 319, 332, 344, 355, 365, 374, 382, 424, 437, 449, 460, &
    470, 479, 487, 528, 540, 551, 561, 570, 578, 618, 629, 639, 648, 656, 695, 705, &
    714, 722, 760, 769, 777, 814, 822, 858, 34, 49, 63, 76, 88, 99, 109, 118, 126, &
    133, 185, 199, 212, 224, 235, 245, 254, 262, 269, 319, 332, 344, 355, 365, 374, &
    382, 389, 437, 449, 460, 470, 479, 487, 494, 540, 551, 561, 570, 578, 585, 629, &
    639, 648, 656, 663, 705, 714, 722, 729, 769, 777, 784, 822, 829, 865, 49, 63, &
    76, 88, 99, 109, 118, 126, 133, 139, 199, 212, 224, 235, 245, 254, 262, 269, &
    275, 332, 344, 355, 365, 374, 382, 389, 395, 449, 460, 470, 479, 487, 494, 500, &
    551, 561, 570, 578, 585, 591, 639, 648, 656, 663, 669, 714, 722, 729, 735, 777, &
    784, 790, 829, 835, 871, 63, 76, 88, 99, 109, 118, 126, 133, 139, 144, 212, 224, &
    235, 245, 254, 262, 269, 275, 280, 344, 355, 365, 374, 382, 389, 395, 400, 460, &
    470, 479, 487, 494, 500, 505, 561, 570, 578, 585, 591, 596, 648, 656, 663, 669, &
    674, 722, 729, 735, 740, 784, 790, 795, 835, 840, 876, 76, 88, 99, 109, 118, &
    126, 133, 139, 144, 148, 224, 235, 245, 254, 262, 269, 275, 280, 284, 355, 365, &
    374, 382, 389, 395, 400, 404, 470, 479, 487, 494, 500, 505, 509, 570, 578, 585, &
    591, 596, 600, 656, 663, 669, 674, 678, 729, 735, 740, 744, 790, 795, 799, 840, &
    844, 880, 88, 99, 109, 118, 126, 133, 139, 144, 148, 151, 235, 245, 254, 262, &
    269, 275, 280, 284, 287, 365, 374, 382, 389, 395, 400, 404, 407, 479, 487, 494, &
    500, 505, 509, 512, 578, 585, 591, 596, 600, 603, 663, 669, 674, 678, 681, 735, &
    740, 744, 747, 795, 799, 802, 844, 847, 883, 99, 109, 118, 126, 133, 139, 144, &
    148, 151, 153, 245, 254, 262, 269, 275, 280, 284, 287, 289, 374, 382, 389, 395, &
    400, 404, 407, 409, 487, 494, 500, 505, 509, 512, 514, 585, 591, 596, 600, 603, &
    605, 669, 674, 678, 681, 683, 740, 744, 747, 749, 799, 802, 804, 847, 849, 885, &
    154, 170, 185, 199, 212, 224, 235, 245, 254, 262, 290, 305, 319, 332, 344, 355, &
    365, 374, 382, 410, 424, 437, 449, 460, 470, 479, 487, 515, 528, 540, 551, 561, &
    570, 578, 606, 618, 629, 639, 648, 656, 684, 695, 705, 714, 722, 750, 760, 769, &
    777, 805, 814, 822, 850, 858, 886, 170, 185, 199, 212, 224, 235, 245, 254, 262, &
    269, 305, 319, 332, 344, 355, 365, 374, 382, 389, 424, 437, 449, 460, 470, 479, &
    487, 494, 528, 540, 551, 561, 570, 578, 585, 618, 629, 639, 648, 656, 663, 695, &
    705, 714, 722, 729, 760, 769, 777, 784, 814, 822, 829, 858, 865, 893, 185, 199, &
    212, 224, 235, 245, 254, 262, 269, 275, 319, 332, 344, 355, 365, 374, 382, 389, &
    395, 437, 449, 460, 470, 479, 487, 494, 500, 540, 551, 561, 570, 578, 585, 591, &
    629, 639, 648, 656, 663, 669, 705, 714, 722, 729, 735, 769, 777, 784, 790, 822, &
    829, 835, 865, 871, 899, 199, 212, 224, 235, 245, 254, 262, 269, 275, 280, 332, &
    344, 355, 365, 374, 382, 389, 395, 400, 449, 460, 470, 479, 487, 494, 500, 505, &
    551, 561, 570, 578, 585, 591, 596, 639, 648, 656, 663, 669, 674, 714, 722, 729, &
    735, 740, 777, 784, 790, 795, 829, 835, 840, 871, 876, 904, 212, 224, 235, 245, &
    254, 262, 269, 275, 280, 284, 344, 355, 365, 374, 382, 389, 395, 400, 404, 460, &
    470, 479, 487, 494, 500, 505, 509, 561, 570, 578, 585, 591, 596, 600, 648, 656, &
    663, 669, 674, 678, 722, 729, 735, 740, 744, 784, 790, 795, 799, 835, 840, 844, &
    876, 880, 908, 224, 235, 245, 254, 262, 269, 275, 280, 284, 287, 355, 365, 374, &
    382, 389, 395, 400, 404, 407, 470, 479, 487, 494, 500, 505, 509, 512, 570, 578, &
    585, 591, 596, 600, 603, 656, 663, 669, 674, 678, 681, 729, 735, 740, 744, 747, &
    790, 795, 799, 802, 840, 844, 847, 880, 883, 911, 235, 245, 254, 262, 269, 275, &
    280, 284, 287, 289, 365, 374, 382, 389, 395, 400, 404, 407, 409, 479, 487, 494, &
    500, 505, 509, 512, 514, 578, 585, 591, 596, 600, 603, 605, 663, 669, 674, 678, &
    681, 683, 735, 740, 744, 747, 749, 795, 799, 802, 804, 844, 847, 849, 883, 885, &
    913, 290, 305, 319, 332, 344, 355, 365, 374, 382, 389, 410, 424, 437, 449, 460, &
    470, 479, 487, 494, 515, 528, 540, 551, 561, 570, 578, 585, 606, 618, 629, 639, &
    648, 656, 663, 684, 695, 705, 714, 722, 729, 750, 760, 769, 777, 784, 805, 814, &
    822, 829, 850, 858, 865, 886, 893, 914, 305, 319, 332, 344, 355, 365, 374, 382, &
    389, 395, 424, 437, 449, 460, 470, 479, 487, 494, 500, 528, 540, 551, 561, 570, &
    578, 585, 591, 618, 629, 639, 648, 656, 663, 669, 695, 705, 714, 722, 729, 735, &
    760, 769, 777, 784, 790, 814, 822, 829, 835, 858, 865, 871, 893, 899, 920, 319, &
    332, 344, 355, 365, 374, 382, 389, 395, 400, 437, 449, 460, 470, 479, 487, 494, &
    500, 505, 540, 551, 561, 570, 578, 585, 591, 596, 629, 639, 648, 656, 663, 669, &
    674, 705, 714, 722, 729, 735, 740, 769, 777, 784, 790, 795, 822, 829, 835, 840, &
    865, 871, 876, 899, 904, 925, 332, 344, 355, 365, 374, 382, 389, 395, 400, 404, &
    449, 460, 470, 479, 487, 494, 500, 505, 509, 551, 561, 570, 578, 585, 591, 596, &
    600, 639, 648, 656, 663, 669, 674, 678, 714, 722, 729, 735, 740, 744, 777, 784, &
    790, 795, 799, 829, 835, 840, 844, 871, 876, 880, 904, 908, 929, 344, 355, 365, &
    374, 382, 389, 395, 400, 404, 407, 460, 470, 479, 487, 494, 500, 505, 509, 512, &
    561, 570, 578, 585, 591, 596, 600, 603, 648, 656, 663, 669, 674, 678, 681, 722, &
    729, 735, 740, 744, 747, 784, 790, 795, 799, 802, 835, 840, 844, 847, 876, 880, &
    883, 908, 911, 932, 355, 365, 374, 382, 389, 395, 400, 404, 407, 409, 470, 479, &
    487, 494, 500, 505, 509, 512, 514, 570, 578, 585, 591, 596, 600, 603, 605, 656, &
    663, 669, 674, 678, 681, 683, 729, 735, 740, 744, 747, 749, 790, 795, 799, 802, &
    804, 840, 844, 847, 849, 880, 883, 885, 911, 913, 934, 410, 424, 437, 449, 460, &
    470, 479, 487, 494, 500, 515, 528, 540, 551, 561, 570, 578, 585, 591, 606, 618, &
    629, 639, 648, 656, 663, 669, 684, 695, 705, 714, 722, 729, 735, 750, 760, 769, &
    777, 784, 790, 805, 814, 822, 829, 835, 850, 858, 865, 871, 886, 893, 899, 914, &
    920, 935, 424, 437, 449, 460, 470, 479, 487, 494, 500, 505, 528, 540, 551, 561, &
    570, 578, 585, 591, 596, 618, 629, 639, 648, 656, 663, 669, 674, 695, 705, 714, &
    722, 729, 735, 740, 760, 769, 777, 784, 790, 795, 814, 822, 829, 835, 840, 858, &
    865, 871, 876, 893, 899, 904, 920, 925, 940, 437, 449, 460, 470, 479, 487, 494, &
    500, 505, 509, 540, 551, 561, 570, 578, 585, 591, 596, 600, 629, 639, 648, 656, &
    663, 669, 674, 678, 705, 714, 722, 729, 735, 740, 744, 769, 777, 784, 790, 795, &
    799, 822, 829, 835, 840, 844, 865, 871, 876, 880, 899, 904, 908, 925, 929, 944, &
    449, 460, 470, 479, 487, 494, 500, 505, 509, 512, 551, 561, 570, 578, 585, 591, &
    596, 600, 603, 639, 648, 656, 663, 669, 674, 678, 681, 714, 722, 729, 735, 740, &
    744, 747, 777, 784, 790, 795, 799, 802, 829, 835, 840, 844, 847, 871, 876, 880, &
    883, 904, 908, 911, 929, 932, 947, 460, 470, 479, 487, 494, 500, 505, 509, 512, &
    514, 561, 570, 578, 585, 591, 596, 600, 603, 605, 648, 656, 663, 669, 674, 678, &
    681, 683, 722, 729, 735, 740, 744, 747, 749, 784, 790, 795, 799, 802, 804, 835, &
    840, 844, 847, 849, 876, 880, 883, 885, 908, 911, 913, 932, 934, 949, 515, 528, &
    540, 551, 561, 570, 578, 585, 591, 596, 606, 618, 629, 639, 648, 656, 663, 669, &
    674, 684, 695, 705, 714, 722, 729, 735, 740, 750, 760, 769, 777, 784, 790, 795, &
    805, 814, 822, 829, 835, 840, 850, 858, 865, 871, 876, 886, 893, 899, 904, 914, &
    920, 925, 935, 940, 950, 528, 540, 551, 561, 570, 578, 585, 591, 596, 600, 618, &
    629, 639, 648, 656, 663, 669, 674, 678, 695, 705, 714, 722, 729, 735, 740, 744, &
    760, 769, 777, 784, 790, 795, 799, 814, 822, 829, 835, 840, 844, 858, 865, 871, &
    876, 880, 893, 899, 904, 908, 920, 925, 929, 940, 944, 954, 540, 551, 561, 570, &
    578, 585, 591, 596, 600, 603, 629, 639, 648, 656, 663, 669, 674, 678, 681, 705, &
    714, 722, 729, 735, 740, 744, 747, 769, 777, 784, 790, 795, 799, 802, 822, 829, &
    835, 840, 844, 847, 865, 871, 876, 880, 883, 899, 904, 908, 911, 925, 929, 932, &
    944, 947, 957, 551, 561, 570, 578, 585, 591, 596, 600, 603, 605, 639, 648, 656, &
    663, 669, 674, 678, 681, 683, 714, 722, 729, 735, 740, 744, 747, 749, 777, 784, &
    790, 795, 799, 802, 804, 829, 835, 840, 844, 847, 849, 871, 876, 880, 883, 885, &
    904, 908, 911, 913, 929, 932, 934, 947, 949, 959, 606, 618, 629, 639, 648, 656, &
    663, 669, 674, 678, 684, 695, 705, 714, 722, 729, 735, 740, 744, 750, 760, 769, &
    777, 784, 790, 795, 799, 805, 814, 822, 829, 835, 840, 844, 850, 858, 865, 871, &
    876, 880, 886, 893, 899, 904, 908, 914, 920, 925, 929, 935, 940, 944, 950, 954, &
    960, 618, 629, 639, 648, 656, 663, 669, 674, 678, 681, 695, 705, 714, 722, 729, &
    735, 740, 744, 747, 760, 769, 777, 784, 790, 795, 799, 802, 814, 822, 829, 835, &
    840, 844, 847, 858, 865, 871, 876, 880, 883, 893, 899, 904, 908, 911, 920, 925, &
    929, 932, 940, 944, 947, 954, 957, 963, 629, 639, 648, 656, 663, 669, 674, 678, &
    681, 683, 705, 714, 722, 729, 735, 740, 744, 747, 749, 769, 777, 784, 790, 795, &
    799, 802, 804, 822, 829, 835, 840, 844, 847, 849, 865, 871, 876, 880, 883, 885, &
    899, 904, 908, 911, 913, 925, 929, 932, 934, 944, 947, 949, 957, 959, 965, 684, &
    695, 705, 714, 722, 729, 735, 740, 744, 747, 750, 760, 769, 777, 784, 790, 795, &
    799, 802, 805, 814, 822, 829, 835, 840, 844, 847, 850, 858, 865, 871, 876, 880, &
    883, 886, 893, 899, 904, 908, 911, 914, 920, 925, 929, 932, 935, 940, 944, 947, &
    950, 954, 957, 960, 963, 966, 695, 705, 714, 722, 729, 735, 740, 744, 747, 749, &
    760, 769, 777, 784, 790, 795, 799, 802, 804, 814, 822, 829, 835, 840, 844, 847, &
    849, 858, 865, 871, 876, 880, 883, 885, 893, 899, 904, 908, 911, 913, 920, 925, &
    929, 932, 934, 940, 944, 947, 949, 954, 957, 959, 963, 965, 968, 750, 760, 769, &
    777, 784, 790, 795, 799, 802, 804, 805, 814, 822, 829, 835, 840, 844, 847, 849, &
    850, 858, 865, 871, 876, 880, 883, 885, 886, 893, 899, 904, 908, 911, 913, 914, &
    920, 925, 929, 932, 934, 935, 940, 944, 947, 949, 950, 954, 957, 959, 960, 963, &
    965, 966, 968, 969], [55, 36])

contains

subroutine auto2e_RCopy_9_7(T, R, idx)
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: R
integer, dimension(:), intent(in) :: idx
T(1:10) = R(idx(1):idx(1)+9)
T(11:19) = R(idx(2):idx(2)+8)
T(20:27) = R(idx(3):idx(3)+7)
T(28:34) = R(idx(4):idx(4)+6)
T(35:40) = R(idx(5):idx(5)+5)
T(41:45) = R(idx(6):idx(6)+4)
T(46:49) = R(idx(7):idx(7)+3)
T(50:52) = R(idx(8):idx(8)+2)
T(53:54) = R(idx(9):idx(9)+1)
T(55) = R(idx(10))
T(56:64) = R(idx(11):idx(11)+8)
T(65:72) = R(idx(12):idx(12)+7)
T(73:79) = R(idx(13):idx(13)+6)
T(80:85) = R(idx(14):idx(14)+5)
T(86:90) = R(idx(15):idx(15)+4)
T(91:94) = R(idx(16):idx(16)+3)
T(95:97) = R(idx(17):idx(17)+2)
T(98:99) = R(idx(18):idx(18)+1)
T(100) = R(idx(19))
T(101:108) = R(idx(20):idx(20)+7)
T(109:115) = R(idx(21):idx(21)+6)
T(116:121) = R(idx(22):idx(22)+5)
T(122:126) = R(idx(23):idx(23)+4)
T(127:130) = R(idx(24):idx(24)+3)
T(131:133) = R(idx(25):idx(25)+2)
T(134:135) = R(idx(26):idx(26)+1)
T(136) = R(idx(27))
T(137:143) = R(idx(28):idx(28)+6)
T(144:149) = R(idx(29):idx(29)+5)
T(150:154) = R(idx(30):idx(30)+4)
T(155:158) = R(idx(31):idx(31)+3)
T(159:161) = R(idx(32):idx(32)+2)
T(162:163) = R(idx(33):idx(33)+1)
T(164) = R(idx(34))
T(165:170) = R(idx(35):idx(35)+5)
T(171:175) = R(idx(36):idx(36)+4)
T(176:179) = R(idx(37):idx(37)+3)
T(180:182) = R(idx(38):idx(38)+2)
T(183:184) = R(idx(39):idx(39)+1)
T(185) = R(idx(40))
T(186:190) = R(idx(41):idx(41)+4)
T(191:194) = R(idx(42):idx(42)+3)
T(195:197) = R(idx(43):idx(43)+2)
T(198:199) = R(idx(44):idx(44)+1)
T(200) = R(idx(45))
T(201:204) = R(idx(46):idx(46)+3)
T(205:207) = R(idx(47):idx(47)+2)
T(208:209) = R(idx(48):idx(48)+1)
T(210) = R(idx(49))
T(211:213) = R(idx(50):idx(50)+2)
T(214:215) = R(idx(51):idx(51)+1)
T(216) = R(idx(52))
T(217:218) = R(idx(53):idx(53)+1)
T(219) = R(idx(54))
T(220) = R(idx(55))
end subroutine auto2e_RCopy_9_7

subroutine auto2e_RCopy_KetTransform_9_7(S, T, Ex, Ey, Ez, R, lx, ly, lz)
!
! Transform the ket shell pair from Hermite to Cartesian Gaussian basis.
! This variant of the transformation algorithm starts by copying the Rtuv
! matrix elements into contiguous memory locations.
!
real(F64), dimension(:), intent(out) :: S
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: Ex, Ey, Ez
real(F64), dimension(:), intent(in) :: R
integer, intent(in) :: lx, ly, lz
real(F64) :: c
integer :: tau, nu, phi, i
integer :: x0, y0, z0, x, y, z
S = ZERO
x0 = ((lx + 1) * lx) / 2 + 1
y0 = ((ly + 1) * ly) / 2 + 1
z0 = ((lz + 1) * lz) / 2 + 1
do phi = 0, lz
do nu = 0, ly
do tau = 0, lx
i = ((2*7+3-phi)*phi)/2+nu+1
call auto2e_Rcopy_9_7(T, R(tau+1:), RCopyIdx_9_7(:, i))
x = x0 + tau
y = y0 + nu
z = z0 + phi
c = (-1)**modulo(tau+nu+phi, 2)*Ex(x)*Ey(y)*Ez(z)
S = S + c * T
end do
end do
end do
end subroutine auto2e_RCopy_KetTransform_9_7
end module auto2e_KetTransform_9_7