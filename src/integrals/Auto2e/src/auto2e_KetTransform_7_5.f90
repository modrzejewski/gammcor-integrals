module auto2e_KetTransform_7_5
use arithmetic
use math_constants
implicit none

integer, dimension(36, 21), parameter :: RCopyIdx_7_5 = reshape([1, 14, 26, 37, 47, &
    56, 64, 71, 92, 104, 115, 125, 134, 142, 149, 170, 181, 191, 200, 208, 215, 236, &
    246, 255, 263, 270, 291, 300, 308, 315, 336, 344, 351, 372, 379, 400, 14, 26, &
    37, 47, 56, 64, 71, 77, 104, 115, 125, 134, 142, 149, 155, 181, 191, 200, 208, &
    215, 221, 246, 255, 263, 270, 276, 300, 308, 315, 321, 344, 351, 357, 379, 385, &
    406, 26, 37, 47, 56, 64, 71, 77, 82, 115, 125, 134, 142, 149, 155, 160, 191, &
    200, 208, 215, 221, 226, 255, 263, 270, 276, 281, 308, 315, 321, 326, 351, 357, &
    362, 385, 390, 411, 37, 47, 56, 64, 71, 77, 82, 86, 125, 134, 142, 149, 155, &
    160, 164, 200, 208, 215, 221, 226, 230, 263, 270, 276, 281, 285, 315, 321, 326, &
    330, 357, 362, 366, 390, 394, 415, 47, 56, 64, 71, 77, 82, 86, 89, 134, 142, &
    149, 155, 160, 164, 167, 208, 215, 221, 226, 230, 233, 270, 276, 281, 285, 288, &
    321, 326, 330, 333, 362, 366, 369, 394, 397, 418, 56, 64, 71, 77, 82, 86, 89, &
    91, 142, 149, 155, 160, 164, 167, 169, 215, 221, 226, 230, 233, 235, 276, 281, &
    285, 288, 290, 326, 330, 333, 335, 366, 369, 371, 397, 399, 420, 92, 104, 115, &
    125, 134, 142, 149, 155, 170, 181, 191, 200, 208, 215, 221, 236, 246, 255, 263, &
    270, 276, 291, 300, 308, 315, 321, 336, 344, 351, 357, 372, 379, 385, 400, 406, &
    421, 104, 115, 125, 134, 142, 149, 155, 160, 181, 191, 200, 208, 215, 221, 226, &
    246, 255, 263, 270, 276, 281, 300, 308, 315, 321, 326, 344, 351, 357, 362, 379, &
    385, 390, 406, 411, 426, 115, 125, 134, 142, 149, 155, 160, 164, 191, 200, 208, &
    215, 221, 226, 230, 255, 263, 270, 276, 281, 285, 308, 315, 321, 326, 330, 351, &
    357, 362, 366, 385, 390, 394, 411, 415, 430, 125, 134, 142, 149, 155, 160, 164, &
    167, 200, 208, 215, 221, 226, 230, 233, 263, 270, 276, 281, 285, 288, 315, 321, &
    326, 330, 333, 357, 362, 366, 369, 390, 394, 397, 415, 418, 433, 134, 142, 149, &
    155, 160, 164, 167, 169, 208, 215, 221, 226, 230, 233, 235, 270, 276, 281, 285, &
    288, 290, 321, 326, 330, 333, 335, 362, 366, 369, 371, 394, 397, 399, 418, 420, &
    435, 170, 181, 191, 200, 208, 215, 221, 226, 236, 246, 255, 263, 270, 276, 281, &
    291, 300, 308, 315, 321, 326, 336, 344, 351, 357, 362, 372, 379, 385, 390, 400, &
    406, 411, 421, 426, 436, 181, 191, 200, 208, 215, 221, 226, 230, 246, 255, 263, &
    270, 276, 281, 285, 300, 308, 315, 321, 326, 330, 344, 351, 357, 362, 366, 379, &
    385, 390, 394, 406, 411, 415, 426, 430, 440, 191, 200, 208, 215, 221, 226, 230, &
    233, 255, 263, 270, 276, 281, 285, 288, 308, 315, 321, 326, 330, 333, 351, 357, &
    362, 366, 369, 385, 390, 394, 397, 411, 415, 418, 430, 433, 443, 200, 208, 215, &
    221, 226, 230, 233, 235, 263, 270, 276, 281, 285, 288, 290, 315, 321, 326, 330, &
    333, 335, 357, 362, 366, 369, 371, 390, 394, 397, 399, 415, 418, 420, 433, 435, &
    445, 236, 246, 255, 263, 270, 276, 281, 285, 291, 300, 308, 315, 321, 326, 330, &
    336, 344, 351, 357, 362, 366, 372, 379, 385, 390, 394, 400, 406, 411, 415, 421, &
    426, 430, 436, 440, 446, 246, 255, 263, 270, 276, 281, 285, 288, 300, 308, 315, &
    321, 326, 330, 333, 344, 351, 357, 362, 366, 369, 379, 385, 390, 394, 397, 406, &
    411, 415, 418, 426, 430, 433, 440, 443, 449, 255, 263, 270, 276, 281, 285, 288, &
    290, 308, 315, 321, 326, 330, 333, 335, 351, 357, 362, 366, 369, 371, 385, 390, &
    394, 397, 399, 411, 415, 418, 420, 430, 433, 435, 443, 445, 451, 291, 300, 308, &
    315, 321, 326, 330, 333, 336, 344, 351, 357, 362, 366, 369, 372, 379, 385, 390, &
    394, 397, 400, 406, 411, 415, 418, 421, 426, 430, 433, 436, 440, 443, 446, 449, &
    452, 300, 308, 315, 321, 326, 330, 333, 335, 344, 351, 357, 362, 366, 369, 371, &
    379, 385, 390, 394, 397, 399, 406, 411, 415, 418, 420, 426, 430, 433, 435, 440, &
    443, 445, 449, 451, 454, 336, 344, 351, 357, 362, 366, 369, 371, 372, 379, 385, &
    390, 394, 397, 399, 400, 406, 411, 415, 418, 420, 421, 426, 430, 433, 435, 436, &
    440, 443, 445, 446, 449, 451, 452, 454, 455], [36, 21])

contains

subroutine auto2e_RCopy_7_5(T, R, idx)
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: R
integer, dimension(:), intent(in) :: idx
T(1:8) = R(idx(1):idx(1)+7)
T(9:15) = R(idx(2):idx(2)+6)
T(16:21) = R(idx(3):idx(3)+5)
T(22:26) = R(idx(4):idx(4)+4)
T(27:30) = R(idx(5):idx(5)+3)
T(31:33) = R(idx(6):idx(6)+2)
T(34:35) = R(idx(7):idx(7)+1)
T(36) = R(idx(8))
T(37:43) = R(idx(9):idx(9)+6)
T(44:49) = R(idx(10):idx(10)+5)
T(50:54) = R(idx(11):idx(11)+4)
T(55:58) = R(idx(12):idx(12)+3)
T(59:61) = R(idx(13):idx(13)+2)
T(62:63) = R(idx(14):idx(14)+1)
T(64) = R(idx(15))
T(65:70) = R(idx(16):idx(16)+5)
T(71:75) = R(idx(17):idx(17)+4)
T(76:79) = R(idx(18):idx(18)+3)
T(80:82) = R(idx(19):idx(19)+2)
T(83:84) = R(idx(20):idx(20)+1)
T(85) = R(idx(21))
T(86:90) = R(idx(22):idx(22)+4)
T(91:94) = R(idx(23):idx(23)+3)
T(95:97) = R(idx(24):idx(24)+2)
T(98:99) = R(idx(25):idx(25)+1)
T(100) = R(idx(26))
T(101:104) = R(idx(27):idx(27)+3)
T(105:107) = R(idx(28):idx(28)+2)
T(108:109) = R(idx(29):idx(29)+1)
T(110) = R(idx(30))
T(111:113) = R(idx(31):idx(31)+2)
T(114:115) = R(idx(32):idx(32)+1)
T(116) = R(idx(33))
T(117:118) = R(idx(34):idx(34)+1)
T(119) = R(idx(35))
T(120) = R(idx(36))
end subroutine auto2e_RCopy_7_5

subroutine auto2e_RCopy_KetTransform_7_5(S, T, Ex, Ey, Ez, R, lx, ly, lz)
!
! Transform the ket shell pair from Hermite to Cartesian Gaussian basis.
! This variant of the transformation algorithm starts by copying the Rtuv
! matrix elements into contiguous memory locations.
!
real(F64), dimension(:), intent(out) :: S
real(F64), dimension(:), intent(out) :: T
real(F64), dimension(:), intent(in) :: Ex, Ey, Ez
real(F64), dimension(:), intent(in) :: R
integer, intent(in) :: lx, ly, lz
real(F64) :: c
integer :: tau, nu, phi, i
integer :: x0, y0, z0, x, y, z
S = ZERO
x0 = ((lx + 1) * lx) / 2 + 1
y0 = ((ly + 1) * ly) / 2 + 1
z0 = ((lz + 1) * lz) / 2 + 1
do phi = 0, lz
do nu = 0, ly
do tau = 0, lx
i = ((2*5+3-phi)*phi)/2+nu+1
call auto2e_Rcopy_7_5(T, R(tau+1:), RCopyIdx_7_5(:, i))
x = x0 + tau
y = y0 + nu
z = z0 + phi
c = (-1)**modulo(tau+nu+phi, 2)*Ex(x)*Ey(y)*Ez(z)
S = S + c * T
end do
end do
end do
end subroutine auto2e_RCopy_KetTransform_7_5
end module auto2e_KetTransform_7_5